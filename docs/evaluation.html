<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Evaluation</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-113453617-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-113453617-1');
</script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}

.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->






<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Portal Forecasting</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Current Forecast</a>
</li>
<li>
  <a href="models.html">Current Models</a>
</li>
<li>
  <a href="report.html">Rodent Report</a>
</li>
<li>
  <a href="evaluation.html">Evaluation</a>
</li>
<li>
  <a href="profiles.html">Rodent Profiles</a>
</li>
<li>
  <a href="about.html">About</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Evaluation</h1>

</div>


<section id="how-have-the-models-done-recently" class="level2">
<h2>How have the models done recently?</h2>
<p>This graph shows the forecast error of some recent forecasts for the most recent sampling dates. This is shown for all model types in the columns and several common rodent species (and total rodents) in the rows. These evaluations are for the Control plots where no manipulation is done.</p>
<p>```{r recent_eval, echo = FALSE, message = FALSE, warning = FALSE, fig.width = 15, fig.height = 15}</p>
<p>#Get all the recent forecasts forecast_data &lt;- compile_forecasts(use_hindcasts = FALSE) %&gt;% dplyr::filter(model %in% models_of_interest)</p>
</section>
<section id="round-so-that-large-decimal-place-differences-do-not-cause" class="level1">
<h1>Round so that large decimal place differences do not cause</h1>
</section>
<section id="similar-forecasts-to-be-seen-as-distinct." class="level1">
<h1>similar forecasts to be seen as distinct.</h1>
<p>forecast_data<span class="math inline">\(estimate &lt;- round(forecast_data\)</span>estimate, 3) forecast_data<span class="math inline">\(LowerPI &lt;- round(forecast_data\)</span>LowerPI, 3) forecast_data<span class="math inline">\(UpperPI &lt;- round(forecast_data\)</span>UpperPI, 3)</p>
</section>
<section id="keep-1-forecast-per-unique-initial_newmoon.-when-there-are-multiple" class="level1">
<h1>Keep 1 forecast per unique initial_newmoon. When there are multiple</h1>
</section>
<section id="forecasts-using-the-same-initial_newmoon-use-the-first-one." class="level1">
<h1>forecasts using the same initial_newmoon, use the first one.</h1>
<p>forecast_dates_to_keep &lt;- forecast_data %&gt;% dplyr::select(date, initial_newmoon) %&gt;% dplyr::distinct() %&gt;% dplyr::group_by(initial_newmoon) %&gt;% dplyr::filter(date == min(date)) %&gt;% dplyr::ungroup() %&gt;% dplyr::mutate(keep = “yes”)</p>
<p>joining &lt;- c(“date”, “initial_newmoon”) forecast_data &lt;- forecast_data %&gt;% dplyr::left_join(forecast_dates_to_keep, by = joining) %&gt;% dplyr::filter(keep == “yes”) %&gt;% dplyr::select(-keep)</p>
</section>
<section id="combine-forecasts-and-oservations" class="level1">
<h1>Combine forecasts and oservations</h1>
<p>joining &lt;- c(“newmoonnumber”, “level”, “species”, “currency”) forecast_errors &lt;- forecast_data %&gt;% dplyr::left_join(observation_data, by = joining) %&gt;% dplyr::mutate(rmse = sqrt((estimate - actual)^2))</p>
</section>
<section id="sometimes-there-are-model-runs-on-the-same-day-and-with-all-the-same-info" class="level1">
<h1>Sometimes there are model runs on the same day and with all the same info,</h1>
</section>
<section id="this-gets-rid-of-those" class="level1">
<h1>this gets rid of those</h1>
<p>forecast_errors &lt;- forecast_errors %&gt;% dplyr::distinct()</p>
</section>
<section id="drop-any-entries-that-dont-have-an-observation-ie.-a-rainy-sample-period-forecast_errors---forecast_errors-dplyrfilteris.naactual" class="level1">
<h1>Drop any entries that don“t have an observation # (ie. a rainy sample period) forecast_errors &lt;- forecast_errors %&gt;% dplyr::filter(!is.na(actual))</h1>
</section>
<section id="filter-to-common-species-and-apply-the-full-name" class="level1">
<h1>Filter to common species and apply the full name</h1>
<p>forecast_errors &lt;- forecast_errors %&gt;% dplyr::filter(species %in% species_of_interest) %&gt;% dplyr::left_join(species_names, by = “species”) %&gt;% dplyr::select(-species) %&gt;% dplyr::rename(species = full_species_name)</p>
</section>
<section id="add-a-newline-to-the-longer-species-names" class="level1">
<h1>Add a newline to the longer species names</h1>
<p>forecast_errors$species &lt;- with(forecast_errors, ifelse(nchar(species) &gt; 15, stringr::str_replace(species,&quot; “,”“), species))</p>
</section>
<section id="displaying-the-data-from-many-forecasts-in-the-past-can-create-a-mess-of-a" class="level1">
<h1>Displaying the data from many forecasts in the past can create a mess of a</h1>
</section>
<section id="plot.-see-218.-so-here-three-forecasts-are-chosen-from-1-6-and-12" class="level1">
<h1>plot. see #218. So here three forecasts are chosen from 1, 6, and 12</h1>
</section>
<section id="newmoons-into-the-past.-sometimes-forecasts-data-is-missing-for-a-particular" class="level1">
<h1>newmoons into the past. Sometimes forecasts data is missing for a particular</h1>
</section>
<section id="initial_newmoon-the-recursive-function-here-attempts-to-find-another-one" class="level1">
<h1>initial_newmoon, the recursive function here attempts to find another one</h1>
</section>
<section id="from-the-same-time-plutsminus-2-month-period.-this-ensures-3-forecasts" class="level1">
<h1>from the same time pluts/minus 2 month period. This ensures 3 forecasts</h1>
</section>
<section id="are-always-shown." class="level1">
<h1>are always shown.</h1>
</section>
<section id="if-there-is-no-data-for-initial_newmoon-500-this-will-check-nearby-dates" class="level1">
<h1>If there is no data for initial_newmoon 500, this will check nearby dates</h1>
</section>
<section id="in-this-order-499-501-498-402" class="level1">
<h1>in this order: 499, 501, 498, 402</h1>
<p>update_initial_newmoon &lt;- function(potential_initial_newmoon, attempt = 1){ if (attempt == 6){ return(NA) } lead_time_data &lt;- forecast_errors %&gt;% dplyr::filter(initial_newmoon == potential_initial_newmoon)</p>
<p># Alternate steps of -1, +2, -3, +4 next_try_step &lt;- ifelse(attempt%%2 == 0, attempt, attempt * -1)</p>
<p># no data to show? then try one month back if (nrow(lead_time_data) == 0){ next_nm &lt;- potential_initial_newmoon + next_try_step return(update_initial_newmoon(next_nm, attempt + 1)) } else { return(potential_initial_newmoon) }</p>
<p>}</p>
</section>
<section id="adjust-this-to-add-more-than-3-forecast-dates-or-change-the-lead-times" class="level1">
<h1>Adjust this to add more than 3 forecast dates, or change the lead times</h1>
<p>lead_times_to_show &lt;- c(1,6,12) most_recent_observed_newmoon &lt;- max(new_moons$newmoonnumber) initial_newmoons_to_keep &lt;- most_recent_observed_newmoon - lead_times_to_show</p>
<p>initial_newmoons_to_keep &lt;- sapply(initial_newmoons_to_keep, update_initial_newmoon)</p>
<p>forecast_errors &lt;- forecast_errors %&gt;% dplyr::filter(initial_newmoon %in% initial_newmoons_to_keep)</p>
<p>ggplot2::ggplot(forecast_errors, ggplot2::aes(x = censusdate, y = rmse, group = as.character(date), color = as.character(date))) + ggplot2::geom_point(size = 4)+ ggplot2::geom_line(size = 1.5) + ggplot2::scale_color_brewer(palette = “Dark2”) + ggplot2::scale_x_date(breaks = unique(forecast_errors$censusdate)) + ggplot2::facet_grid(species ~ model, scales = “free_y”) + ggplot2::theme_bw() + ggplot2::theme( axis.text.x = ggplot2::element_text(angle = 45, hjust = 0.99, debug = FALSE), axis.text = ggplot2::element_text(size = 12), axis.title = ggplot2::element_text(size = 20), strip.text = ggplot2::element_text(size = 12), legend.text = ggplot2::element_text(size = 15), legend.title = ggplot2::element_text(size = 18)) + ggplot2::labs(x = “Sample Date”,y = “RMSE”, color = “Forecast Issue”)</p>
<p>```</p>
<section id="how-have-the-models-done-historically" class="level2">
<h2>How have the models done historically?</h2>
<p>These graphs show errors as a function of lead time. The lead time is the number of months into the future that forecast is made. The error values are an average of all forecast errors using observations since 2010. Note that this currently uses hindcasts of the prior observations, and is also only for the Control plots.</p>
<p><strong>RMSE</strong>: Root mean square error, this is a metric used to evaluate the point estimate of a forecast.<br />
<strong>Coverage</strong>: This is the percentage of observations which fell within the 90% confidence interval of a forecast. Ideally this would be equal to 0.9. If it’s higher than 0.9 the forecasts intervals are too wide, if it’s lower, then the forecast intervals are too narrow.</p>
<p>```{r hindcast_eval, echo = FALSE, message = FALSE, warning = FALSE, fig.width = 9, fig.height = 15}</p>
</section>
</section>
<section id="get-the-all-the-forecasts-made-during-observation-period" class="level1">
<h1>Get the all the forecasts made during observation period</h1>
</section>
<section id="dropping-rmse-greater-than-this-because-it-throws-off-all-the-graphs" class="level1">
<h1>Dropping RMSE greater than this because it throws off all the graphs</h1>
<p>forecast_data &lt;- compile_forecasts(use_hindcasts = TRUE) fcast_err &lt;- calculate_forecast_error(observation_data, forecast_data, error_metric = “coverage”) forecast_errors &lt;- calculate_forecast_error(observation_data, forecast_data, error_metric = “RMSE”) %&gt;% dplyr::filter(error_value &lt; 200) %&gt;% dplyr::bind_rows(fcast_err) %&gt;% dplyr::left_join(species_names, by = “species”)</p>
<p>ggplot2::ggplot(forecast_errors, ggplot2::aes(x = lead_time, y = error_value, group = model, color = model)) + ggplot2::geom_point()+ ggplot2::geom_line() + ggplot2::geom_hline(yintercept = 0.9) + ggplot2::labs(x = “Lead Time (New Moons)”) + ggplot2::facet_wrap(full_species_name ~ error_metric, scales = “free_y”, ncol = 2) + ggplot2::theme_bw() + ggplot2::labs(y = “Error Value”, colour = “Model”)</p>
<p>```</p>
</section>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
